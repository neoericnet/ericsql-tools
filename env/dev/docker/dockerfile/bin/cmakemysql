#!/bin/bash
set -e

##prepare
#prepare dir
mkdir -p $BUILD_PATH/mysql
mkdir -p $BUILD_PATH/3rd/boost
#prepare 3rd
cd $BUILD_PATH/3rd/boost
if [ ! -d "boost_1_59_0" ]; then
  if [ ! -f "boost_1_59_0.tar.gz" ]; then
    cp -rf $SOURCE_PATH/mysql-tools/3rd/boost/boost_1_59_0.tar.gz $BUILD_PATH/3rd/boost
  fi
  tar xvf boost_1_59_0.tar.gz
fi

#cmake
cd $BUILD_PATH/mysql
ls |grep -v "^debug$" |xargs rm -rf
cmake $SOURCE_PATH/mysql -DCMAKE_INSTALL_PREFIX=/debug/ -DCMAKE_BUILD_TYPE=Debug -DWITH_INNODB_MEMCACHED=1 \
  -DWITH_BOOST=$BUILD_PATH/3rd/boost/boost_1_59_0
