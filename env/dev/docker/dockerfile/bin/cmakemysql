#!/bin/bash
set -e

##prepare
#prepare dir
mkdir -p $HOME/build/mysql
mkdir -p $HOME/build/3rd/boost
#prepare 3rd
cd $HOME/build/3rd/boost
if [ ! -d "boost_1_59_0" ]; then
  if [ ! -f "boost_1_59_0.tar.gz" ]; then
    cp -rf $HOME/source/mysql-tools/3rd/boost/boost_1_59_0.tar.gz $HOME/build/3rd/boost
  fi
  tar xvf boost_1_59_0.tar.gz
fi

#cmake
cd $HOME/build/mysql
ls |grep -v "^debug$" |xargs rm -rf
cmake $HOME/source/mysql -DCMAKE_INSTALL_PREFIX=/debug/ -DCMAKE_BUILD_TYPE=Debug -DWITH_INNODB_MEMCACHED=1 -DWITH_BOOST=$HOME/build/3rd/boost/boost_1_59_0
